<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Crawler - Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <style>
        /* Status Code Styling */
        .status-success { 
            background-color: #28a745 !important; 
            color: white !important;
        }
        .status-redirect { 
            background-color: #ffc107 !important; 
            color: #000 !important;
        }
        .status-error { 
            background-color: #dc3545 !important; 
            color: white !important;
        }
        .status-unknown { 
            background-color: #6c757d !important; 
            color: white !important;
        }
        
        .status-info {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .status-impact {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .response-time {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .redirect-chain {
            color: #17a2b8;
            margin-top: 5px;
        }
        
        .status-details {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-top: 10px;
        }
        
        /* Version Navigation Styling */
        .version-navigation {
            box-shadow: 0 2px 10px rgba(0,123,255,0.15);
            position: relative;
            z-index: 100;
        }
        
        .version-navigation .card-header {
            position: relative;
            z-index: 101;
        }
        
        .version-navigation .btn-group {
            position: relative;
            z-index: 102;
        }
        
        .version-navigation .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
            min-width: 280px;
            border: 2px solid #007bff;
            box-shadow: 0 4px 20px rgba(0,123,255,0.25);
            z-index: 99999 !important;
            position: absolute !important;
            background: white !important;
            border-radius: 8px;
        }
        
        .version-navigation .dropdown {
            position: static !important;
        }
        
        .version-navigation .dropdown-toggle {
            position: relative;
            z-index: 1000;
        }
        
        /* Force dropdown to appear on top of all other elements */
        .version-navigation .dropdown-menu.show {
            z-index: 999999 !important;
            position: absolute !important;
        }
        
        /* Global override for any conflicting z-index */
        .dropdown-menu {
            z-index: 99999 !important;
        }
        
        /* Ensure parent containers don't interfere */
        .card {
            overflow: visible !important;
        }
        
        .card-header {
            overflow: visible !important;
        }
        
        .version-dropdown-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            font-weight: 500;
            min-width: 120px;
        }
        
        .version-dropdown-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            color: white;
        }
        
        .version-dropdown-btn:focus {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.25);
        }
        
        .version-dropdown-btn.show {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            color: white;
        }
        
        .version-navigation .dropdown-item {
            padding: 8px 16px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .version-navigation .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .version-navigation .dropdown-item.active {
            background: #007bff;
            color: white;
            font-weight: 600;
        }
        
        .version-navigation .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .version-navigation .dropdown-item.active:hover {
            background: #0056b3;
            color: white;
        }
        
        .version-navigation .dropdown-header {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            padding: 8px 16px;
            margin: 0;
        }
        
        .version-badge {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .score-change-positive {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .score-change-negative {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .score-change-neutral {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
        
        /* Quick Overview Cards Styling */
        .quick-overview-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-width: 2px !important;
        }
        
        .quick-overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        }
        
        .quick-overview-card .card-body {
            padding: 1.25rem;
        }
        
        .quick-overview-card .card-title {
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .quick-overview-card .h4 {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        /* Retry button styling */
        .retry-url-btn {
            white-space: nowrap;
            min-width: auto;
        }
        
        @media (max-width: 768px) {
            .d-flex.align-items-center.justify-content-between {
                flex-direction: column;
                align-items: flex-start !important;
            }
            
            .retry-url-btn {
                margin-top: 0.5rem;
                align-self: flex-end;
            }
            
            /* Final URL section responsiveness */
            .d-flex.align-items-center:has(.btn-outline-info) {
                flex-direction: column;
                align-items: flex-start !important;
            }
            
            .btn-outline-info {
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-search me-2"></i>SEO Crawler
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/reports-overview">
                            <i class="fas fa-chart-bar me-1"></i>Reports Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/browse">
                            <i class="fas fa-history me-1"></i>Browse Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/batches">
                            <i class="fas fa-tasks me-1"></i>Batches
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/url-versions">
                            <i class="fas fa-code-branch me-1"></i>URL Versions
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i><%= user.username %>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/logout">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>SEO Analysis Report</h2>
                    <a href="/" class="btn btn-outline-primary">
                        <i class="fas fa-plus me-2"></i>New Analysis
                    </a>
                </div>

                <!-- Version Navigation -->
                <% if (versionInfo) { %>
                    <% if (versionInfo.totalVersions > 1) { %>
                <div class="card mb-4 border-primary version-navigation">
                    <div class="card-header bg-primary text-white">
                        <div class="row align-items-center">
                            <div class="col-lg-7 col-md-6 mb-2 mb-md-0">
                                <h6 class="mb-0">
                                    <i class="fas fa-code-branch me-2"></i>
                                    Version <%= versionInfo.version_number %> of <%= versionInfo.totalVersions %>
                                    <% if (versionInfo.isLatest) { %>
                                        <span class="badge bg-success ms-2">Latest</span>
                                    <% } %>
                                </h6>
                            </div>
                            <div class="col-lg-5 col-md-6 text-end">
                                <div class="btn-group btn-group-sm flex-wrap" role="group">
                                    <% if (versionInfo.nextVersion) { %>
                                        <a href="/report/<%= versionInfo.nextVersion.report_id %>" class="btn btn-outline-light" title="Newer Version">
                                            <i class="fas fa-chevron-left me-1"></i>v<%= versionInfo.nextVersion.version_number %>
                                        </a>
                                    <% } else { %>
                                        <button class="btn btn-outline-light" disabled>
                                            <i class="fas fa-chevron-left me-1"></i>Newer
                                        </button>
                                    <% } %>
                                    
                                    <button type="button" class="btn dropdown-toggle version-dropdown-btn" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-list me-1"></i>Versions (<%= versionInfo.totalVersions %>)
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><h6 class="dropdown-header">Available Versions</h6></li>
                                        <% allVersions.forEach((version, index) => { %>
                                            <li>
                                                <% if (version.id === versionInfo.id) { %>
                                                    <span class="dropdown-item active">
                                                        <i class="fas fa-check me-2"></i>
                                                        <strong>v<%= version.version_number %></strong>
                                                        <% const versionScore = version.seo_score || 0; %>
                                                        <span class="ms-2 badge bg-light text-dark">Score: <%= versionScore %></span>
                                                        <small class="text-white-50 d-block mt-1"><%= new Date(version.created_at).toLocaleDateString() %></small>
                                                    </span>
                                                <% } else { %>
                                                    <a class="dropdown-item" href="/report/<%= version.report_id %>">
                                                        <i class="fas fa-file-alt me-2 text-primary"></i>
                                                        <strong>v<%= version.version_number %></strong>
                                                        <% const versionScore = version.seo_score || 0; %>
                                                        <span class="ms-2 badge bg-secondary">Score: <%= versionScore %></span>
                                                        <small class="text-muted d-block mt-1"><%= new Date(version.created_at).toLocaleDateString() %></small>
                                                    </a>
                                                <% } %>
                                            </li>
                                        <% }); %>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><h6 class="dropdown-header">Actions</h6></li>
                                        <li>
                                            <a class="dropdown-item" href="/url-history?url=<%= encodeURIComponent(report.summary.url) %>">
                                                <i class="fas fa-history me-2 text-info"></i>View Full History
                                            </a>
                                        </li>
                                        <% if (allVersions.length > 1) { %>
                                        <li>
                                            <a class="dropdown-item" href="/url-compare?url=<%= encodeURIComponent(report.summary.url) %>&v1=<%= versionInfo.version_number %>&v2=<%= versionInfo.previousVersion ? versionInfo.previousVersion.version_number : (versionInfo.nextVersion ? versionInfo.nextVersion.version_number : 1) %>">
                                                <i class="fas fa-exchange-alt me-2 text-warning"></i>Compare Versions
                                            </a>
                                        </li>
                                        <% } %>
                                    </ul>
                                    
                                    <% if (versionInfo.previousVersion) { %>
                                        <a href="/report/<%= versionInfo.previousVersion.report_id %>" class="btn btn-outline-light" title="Older Version">
                                            v<%= versionInfo.previousVersion.version_number %><i class="fas fa-chevron-right ms-1"></i>
                                        </a>
                                    <% } else { %>
                                        <button class="btn btn-outline-light" disabled>
                                            Older<i class="fas fa-chevron-right ms-1"></i>
                                        </button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    Crawled: <%= new Date(versionInfo.created_at).toLocaleString() %>
                                    <% if (versionInfo.batch_name) { %>
                                        | <i class="fas fa-folder me-1"></i>Batch: <%= versionInfo.batch_name %>
                                    <% } %>
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <% if (versionInfo.previousVersion) { %>
                                    <% 
                                      // Use consistent final score for comparison
                                      const currentScore = report.scoreBreakdown ? report.scoreBreakdown.finalScore : (versionInfo.seo_score || 0);
                                      const previousScore = versionInfo.previousVersion.seo_score || 0;
                                      const scoreDiff = currentScore - previousScore;
                                    %>
                                    <% if (scoreDiff > 0) { %>
                                        <span class="badge bg-success">
                                            <i class="fas fa-arrow-up me-1"></i>+<%= scoreDiff %> from previous
                                        </span>
                                    <% } else if (scoreDiff < 0) { %>
                                        <span class="badge bg-danger">
                                            <i class="fas fa-arrow-down me-1"></i><%= scoreDiff %> from previous
                                        </span>
                                    <% } else { %>
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-minus me-1"></i>No change from previous
                                        </span>
                                    <% } %>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
                    <% } else { %>
                <!-- Single Version Indicator -->
                <div class="alert alert-info mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>First Version</strong> - This is the first crawl of this URL
                        </div>
                        <div>
                            <a href="/url-history?url=<%= encodeURIComponent(report.summary.url) %>" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-history me-1"></i>View History
                            </a>
                        </div>
                    </div>
                </div>
                    <% } %>
                <% } %>

                <!-- Summary Card -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <h6 class="mb-0"><strong>URL:</strong> <a href="<%= report.summary.url %>" target="_blank"><%= report.summary.url %></a></h6>
                                    <button type="button" class="btn btn-outline-primary btn-sm retry-url-btn" 
                                            data-url="<%= report.summary.url %>" 
                                            data-job-id="<%= dbReport.job_id || '' %>"
                                            title="Re-analyze this URL to get fresh data">
                                        <i class="fas fa-redo me-1"></i>Retry Analysis
                                    </button>
                                </div>
                                <div class="mb-2">
                                    <p class="mb-1"><strong>Analyzed:</strong> <%= new Date(dbReport.created_at).toLocaleString() %></p>
                                    <% if (report.details.finalUrl && report.details.finalUrl !== report.summary.url) { %>
                                        <p class="mb-1"><strong>Final URL:</strong> <a href="<%= report.details.finalUrl %>" target="_blank"><%= report.details.finalUrl %></a></p>
                                        <div class="d-flex align-items-center">
                                            <small class="text-info me-3"><i class="fas fa-info-circle me-1"></i>This URL redirected to the final URL shown above</small>
                                            <a href="/reports-overview?search=<%= encodeURIComponent(report.details.finalUrl) %>" 
                                               class="btn btn-outline-info btn-sm" 
                                               title="View analysis of the final URL">
                                                <i class="fas fa-external-link-alt me-1"></i>View Final URL Analysis
                                            </a>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <!-- Enhanced Status Code Display -->
                                <div class="status-info">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Status Code:</strong>
                                        <% 
                                            const statusCode = report.summary.statusCode || 0;
                                            let statusClass = 'status-unknown';
                                            let statusText = 'Unknown';
                                            let statusDescription = 'Status code information not available';
                                            let statusImpact = 'Unable to determine impact';
                                            
                                            // Check for crawl failures (statusCode 0 with error details)
                                            const hasCrawlError = report.details.error || 
                                                                  (report.details.statusInfo && report.details.statusInfo.details && report.details.statusInfo.details.crawlFailed) ||
                                                                  (report.details.statusInfo && report.details.statusInfo.statusCategory === 'failed');
                                            
                                            if (statusCode === 0 && hasCrawlError) {
                                                statusClass = 'status-error';
                                                statusText = 'Crawl Failed';
                                                if (report.details.error && report.details.error.message) {
                                                    statusDescription = report.details.error.message;
                                                } else if (report.details.statusInfo && report.details.statusInfo.statusMessage) {
                                                    statusDescription = report.details.statusInfo.statusMessage;
                                                } else {
                                                    statusDescription = 'Failed to analyze the URL';
                                                }
                                                statusImpact = 'Critical for SEO - search engines cannot access this page';
                                            } else if (statusCode >= 200 && statusCode < 300) {
                                                statusClass = 'status-success';
                                                statusText = 'Success';
                                                statusDescription = 'Request completed successfully';
                                                statusImpact = 'Good for SEO - search engines can crawl and index this page';
                                            } else if (statusCode >= 300 && statusCode < 400) {
                                                statusClass = 'status-redirect';
                                                statusText = 'Redirect';
                                                statusDescription = 'Page redirects to another location';
                                                statusImpact = 'May impact SEO - ensure redirect chain is not too long';
                                            } else if (statusCode >= 400 && statusCode < 500) {
                                                statusClass = 'status-error';
                                                statusText = 'Client Error';
                                                statusDescription = 'Page cannot be found or accessed';
                                                statusImpact = 'Bad for SEO - search engines cannot index this page';
                                            } else if (statusCode >= 500) {
                                                statusClass = 'status-error';
                                                statusText = 'Server Error';
                                                statusDescription = 'Server is unable to process the request';
                                                statusImpact = 'Bad for SEO - temporary server issues can hurt rankings';
                                            }
                                        %>
                                        <span class="badge <%= statusClass %>" data-bs-toggle="tooltip" title="<%= statusDescription %>">
                                            <%= statusCode %> - <%= statusText %>
                                        </span>
                                    </div>
                                    
                                    <% if (report.summary.responseTime) { %>
                                        <div class="response-time">
                                            <i class="fas fa-clock me-2"></i>
                                            <strong>Response Time:</strong> <%= report.summary.responseTime %>ms
                                        </div>
                                    <% } %>
                                    
                                    <% if (report.summary.redirectChain && report.summary.redirectChain.length > 1) { %>
                                        <div class="redirect-chain">
                                            <i class="fas fa-route me-2"></i>
                                            <strong>Redirect Chain:</strong> <%= report.summary.redirectChain.length - 1 %> redirects
                                            <div class="status-details">
                                                <% report.summary.redirectChain.forEach((redirect, index) => { %>
                                                    <div class="small">
                                                        <%= index + 1 %>. <%= redirect.url %> 
                                                        <% if (redirect.statusCode) { %>
                                                            (<%= redirect.statusCode %>)
                                                        <% } %>
                                                    </div>
                                                <% }); %>
                                            </div>
                                        </div>
                                    <% } %>
                                    
                                    <div class="status-impact">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>SEO Impact:</strong> <%= statusImpact %>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <% 
                                  // Use consistent score from detailed breakdown if available, fallback to summary
                                  const finalScore = report.scoreBreakdown ? report.scoreBreakdown.finalScore : report.summary.seoScore;
                                  const totalPenalties = report.scoreBreakdown ? report.scoreBreakdown.totalPenalties : (100 - report.summary.seoScore);
                                %>
                                <div class="seo-score-circle">
                                    <div class="score-number <%= finalScore >= 80 ? 'text-success' : finalScore >= 60 ? 'text-warning' : 'text-danger' %>">
                                        <%= finalScore %>
                                    </div>
                                    <div class="score-label">SEO Score</div>
                                </div>
                                <div class="mt-2">
                                    <p class="mb-1"><strong>Issues Found:</strong> <%= report.summary.totalIssues %></p>
                                    <small class="text-muted">Penalties: -<%= totalPenalties %> points</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Overview Cards -->
                <div class="row mb-4">
                    <!-- PWA Status Card -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card h-100 border-info quick-overview-card">
                            <div class="card-body text-center">
                                <h6 class="card-title text-info">
                                    <i class="fas fa-mobile-alt me-2"></i>PWA Status
                                </h6>
                                <% 
                                  const pwaData = report.details.pwa || {};
                                  const pwaScore = pwaData.score || 0;
                                  const hasManifest = pwaData.hasManifest || false;
                                %>
                                <div class="h4 <%= pwaScore >= 50 ? 'text-success' : pwaScore >= 20 ? 'text-warning' : 'text-danger' %>">
                                    <%= pwaScore %>/100
                                </div>
                                <small class="text-muted">
                                    <%= hasManifest ? 'Has Web App Manifest' : 'No Web App Manifest' %>
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Schema Status Card -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card h-100 border-warning quick-overview-card">
                            <div class="card-body text-center">
                                <h6 class="card-title text-warning">
                                    <i class="fas fa-code me-2"></i>Schema Markup
                                </h6>
                                <% 
                                  const schemaData = report.details.schema || {};
                                  const totalSchemas = schemaData.summary?.totalSchemas || 0;
                                  const hasErrors = schemaData.validationErrors && schemaData.validationErrors.length > 0;
                                %>
                                <div class="h4 <%= totalSchemas > 0 ? 'text-success' : 'text-danger' %>">
                                    <%= totalSchemas %>
                                </div>
                                <small class="text-muted">
                                    <%= totalSchemas === 0 ? 'No structured data' : (totalSchemas === 1 ? '1 schema found' : totalSchemas + ' schemas found') %>
                                    <% if (hasErrors) { %>
                                        <br><span class="text-danger">Has validation errors</span>
                                    <% } %>
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Optimization Card -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card h-100 border-success quick-overview-card">
                            <div class="card-body text-center">
                                <h6 class="card-title text-success">
                                    <i class="fas fa-images me-2"></i>Image Optimization
                                </h6>
                                <% 
                                  const images = report.details.images || [];
                                  const totalImages = images.length;
                                  const imagesWithoutAlt = images.filter(img => !img.hasAlt || img.isEmpty).length;
                                  const optimizationRate = totalImages > 0 ? Math.round(((totalImages - imagesWithoutAlt) / totalImages) * 100) : 100;
                                %>
                                <div class="h4 <%= optimizationRate >= 80 ? 'text-success' : optimizationRate >= 50 ? 'text-warning' : 'text-danger' %>">
                                    <%= optimizationRate %>%
                                </div>
                                <small class="text-muted">
                                    <%= totalImages %> total images<br>
                                    <%= imagesWithoutAlt %> missing alt text
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Card -->
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card h-100 border-primary quick-overview-card">
                            <div class="card-body text-center">
                                <h6 class="card-title text-primary">
                                    <i class="fas fa-tachometer-alt me-2"></i>Performance
                                </h6>
                                <% 
                                  const responseTime = report.summary.responseTime || 0;
                                  const isHTTPS = report.summary.url && report.summary.url.startsWith('https://');
                                %>
                                <div class="h4 <%= responseTime < 1000 ? 'text-success' : responseTime < 3000 ? 'text-warning' : 'text-danger' %>">
                                    <%= responseTime %>ms
                                </div>
                                <small class="text-muted">
                                    Response time<br>
                                    <span class="<%= isHTTPS ? 'text-success' : 'text-danger' %>">
                                        <%= isHTTPS ? 'HTTPS ✓' : 'HTTP only ✗' %>
                                    </span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Score Calculator -->
                <%- include('partials/score-calculator') %>

                <!-- Detailed SEO Score Breakdown -->
                <% if (report.scoreBreakdown) { %>
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>Detailed SEO Score Breakdown
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Score Overview -->
                        <div class="row mb-4">
                            <div class="col-md-4 text-center">
                                <div class="score-summary-circle mx-auto mb-2" style="width: 120px; height: 120px; border-radius: 50%; background: <%= report.scoreBreakdown.finalScore >= 80 ? '#28a745' : report.scoreBreakdown.finalScore >= 60 ? '#ffc107' : report.scoreBreakdown.finalScore >= 40 ? '#fd7e14' : '#dc3545' %>; color: white; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                    <div style="font-size: 2.5rem; font-weight: bold;"><%= report.scoreBreakdown.finalScore %></div>
                                    <div style="font-size: 0.9rem;">Final Score</div>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <h6 class="text-muted">Starting Score</h6>
                                <div class="h3 text-success"><%= report.scoreBreakdown.baseScore %></div>
                                <small class="text-muted">Perfect SEO</small>
                            </div>
                            <div class="col-md-4 text-center">
                                <h6 class="text-muted">Total Penalties</h6>
                                <div class="h3 text-danger">-<%= report.scoreBreakdown.totalPenalties %></div>
                                <small class="text-muted">Points deducted</small>
                            </div>
                        </div>

                        <!-- Scoring Formula -->
                        <div class="alert alert-info mb-4">
                            <div class="text-center">
                                <code class="fs-5">Final Score = max(0, <%= report.scoreBreakdown.baseScore %> - <%= report.scoreBreakdown.totalPenalties %>) = <%= report.scoreBreakdown.finalScore %></code>
                            </div>
                        </div>

                        <!-- Detailed Section Breakdown -->
                        <div class="row">
                            <!-- Meta Data Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-tags me-2 text-primary"></i>
                                            Meta Data & Basic SEO
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.metaData.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.metaData.currentScore %>/<%= report.scoreBreakdown.sections.metaData.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.metaData.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.metaData.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>

                            <!-- Content Structure Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-heading me-2 text-info"></i>
                                            Content Structure & Headers
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.contentStructure.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.contentStructure.currentScore %>/<%= report.scoreBreakdown.sections.contentStructure.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.contentStructure.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.contentStructure.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>

                            <!-- Image Optimization Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-images me-2 text-warning"></i>
                                            Image Optimization
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.imageOptimization.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.imageOptimization.currentScore %>/<%= report.scoreBreakdown.sections.imageOptimization.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.imageOptimization.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.imageOptimization.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>

                            <!-- Technical Performance Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-server me-2 text-danger"></i>
                                            Technical Performance & Security
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.technicalPerformance.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.technicalPerformance.currentScore %>/<%= report.scoreBreakdown.sections.technicalPerformance.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.technicalPerformance.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.technicalPerformance.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>

                            <!-- Schema Markup Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-code me-2 text-info"></i>
                                            Schema Markup & Structured Data
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.schemaMarkup.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.schemaMarkup.currentScore %>/<%= report.scoreBreakdown.sections.schemaMarkup.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.schemaMarkup.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.schemaMarkup.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>

                            <!-- Progressive Web App Section -->
                            <div class="col-lg-6 mb-4">
                                <div class="scoring-section border rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">
                                            <i class="fas fa-mobile-alt me-2 text-success"></i>
                                            Progressive Web App Features
                                        </h6>
                                        <div class="score-badge">
                                            <span class="badge bg-<%= report.scoreBreakdown.sections.progressiveWebApp.penalties.length === 0 ? 'success' : 'warning' %> fs-6">
                                                <%= report.scoreBreakdown.sections.progressiveWebApp.currentScore %>/<%= report.scoreBreakdown.sections.progressiveWebApp.maxScore %>
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Good Items -->
                                    <% report.scoreBreakdown.sections.progressiveWebApp.items.forEach(item => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <strong><%= item.item %></strong>
                                            <div class="small text-muted"><%= item.details %></div>
                                        </div>
                                        <span class="text-success">✓</span>
                                    </div>
                                    <% }); %>
                                    
                                    <!-- Penalties -->
                                    <% report.scoreBreakdown.sections.progressiveWebApp.penalties.forEach(penalty => { %>
                                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                        <div>
                                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                            <strong><%= penalty.issue %></strong>
                                            <div class="small text-muted"><%= penalty.reason %></div>
                                        </div>
                                        <span class="badge bg-danger">-<%= penalty.penalty %> pts</span>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>
                        </div>

                        <!-- Summary -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-light">
                                    <h6 class="alert-heading mb-2">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Scoring Summary
                                    </h6>
                                    <div class="row text-center">
                                        <div class="col-2">
                                            <div class="small text-muted">Meta Data</div>
                                            <div class="fw-bold <%= report.scoreBreakdown.sections.metaData.penalties.length === 0 ? 'text-success' : 'text-warning' %>">
                                                <%= report.scoreBreakdown.sections.metaData.currentScore %>/<%= report.scoreBreakdown.sections.metaData.maxScore %>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="small text-muted">Content</div>
                                            <div class="fw-bold <%= report.scoreBreakdown.sections.contentStructure.penalties.length === 0 ? 'text-success' : 'text-warning' %>">
                                                <%= report.scoreBreakdown.sections.contentStructure.currentScore %>/<%= report.scoreBreakdown.sections.contentStructure.maxScore %>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="small text-muted">Images</div>
                                            <div class="fw-bold <%= report.scoreBreakdown.sections.imageOptimization.penalties.length === 0 ? 'text-success' : 'text-warning' %>">
                                                <%= report.scoreBreakdown.sections.imageOptimization.currentScore %>/<%= report.scoreBreakdown.sections.imageOptimization.maxScore %>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="small text-muted">Technical</div>
                                            <div class="fw-bold <%= report.scoreBreakdown.sections.technicalPerformance.penalties.length === 0 ? 'text-success' : 'text-warning' %>">
                                                <%= report.scoreBreakdown.sections.technicalPerformance.currentScore %>/<%= report.scoreBreakdown.sections.technicalPerformance.maxScore %>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="small text-muted">Schema</div>
                                            <div class="fw-bold <%= report.scoreBreakdown.sections.schemaMarkup.penalties.length === 0 ? 'text-success' : 'text-warning' %>">
                                                <%= report.scoreBreakdown.sections.schemaMarkup.currentScore %>/<%= report.scoreBreakdown.sections.schemaMarkup.maxScore %>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="small text-muted">PWA</div>
                                            <div class="fw-bold">
                                                <% if (report.scoreBreakdown.sections.progressiveWebApp.hasPWA) { %>
                                                    <span class="badge bg-success">Has PWA</span>
                                                <% } else { %>
                                                    <span class="badge bg-secondary">No PWA</span>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>

                <!-- Recommendations -->
                <% if (report.recommendations && report.recommendations.length > 0) { %>
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>Recommendations
                        </h5>
                    </div>
                    <div class="card-body">
                        <% report.recommendations.forEach((rec, index) => { %>
                        <div class="alert <%= rec.type === 'critical' ? 'alert-danger' : rec.type === 'warning' ? 'alert-warning' : 'alert-info' %>">
                            <div class="d-flex">
                                <div class="me-3">
                                    <% if (rec.type === 'critical') { %>
                                        <i class="fas fa-exclamation-circle"></i>
                                    <% } else if (rec.type === 'warning') { %>
                                        <i class="fas fa-exclamation-triangle"></i>
                                    <% } else { %>
                                        <i class="fas fa-info-circle"></i>
                                    <% } %>
                                </div>
                                <div class="flex-grow-1">
                                    <strong><%= rec.issue %></strong>
                                    <p class="mb-0 mt-1"><%= rec.suggestion %></p>
                                    
                                    <!-- Detailed Image Issues -->
                                    <% if (rec.details && rec.details.type === 'images_missing_alt') { %>
                                    <div class="mt-3">
                                        <h6>🖼️ Images Missing Alt Text (<%= rec.details.count %> found):</h6>
                                        <div class="accordion" id="imageAccordion<%= index %>">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#imageDetails<%= index %>">
                                                        <i class="fas fa-code me-2"></i>View Copy-Ready Fixes
                                                    </button>
                                                </h2>
                                                <div id="imageDetails<%= index %>" class="accordion-collapse collapse" data-bs-parent="#imageAccordion<%= index %>">
                                                    <div class="accordion-body">
                                                        <div class="alert alert-info mb-3">
                                                            <i class="fas fa-info-circle me-2"></i>
                                                            <strong>How to fix:</strong> Add the <code>alt</code> attribute to each image tag with descriptive text that explains what the image shows.
                                                        </div>
                                                        
                                                        <% rec.details.images.forEach((img, imgIndex) => { %>
                                                        <div class="card mb-3">
                                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                                <span><strong>Image #<%= imgIndex + 1 %></strong></span>
                                                                <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('fix<%= index %>_<%= imgIndex %>')">
                                                                    <i class="fas fa-copy me-1"></i>Copy Fix
                                                                </button>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="row">
                                                                    <div class="col-md-6">
                                                                        <h6>📂 Current Code:</h6>
                                                                        <div class="bg-light p-2 rounded">
                                                                            <code style="word-break: break-all;">
                                                                                <%= img.htmlSnippet.replace(/>/g, '&gt;').replace(/</g, '&lt;') %>
                                                                            </code>
                                                                        </div>
                                                                        
                                                                        <div class="mt-2">
                                                                            <small class="text-muted">
                                                                                <strong>📁 File:</strong> <%= img.src %><br>
                                                                                <strong>📍 Context:</strong> <%= img.context || 'No context available' %><br>
                                                                                <strong>🏷️ Parent:</strong> <%= img.parentElement %>
                                                                            </small>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <h6>✅ Fixed Code:</h6>
                                                                        <div class="bg-success bg-opacity-10 p-2 rounded">
                                                                            <code id="fix<%= index %>_<%= imgIndex %>" style="word-break: break-all;">
                                                                                <%= img.htmlSnippet.replace(/>/g, '&gt;').replace(/</g, '&lt;').replace('&lt;img', `&lt;img alt="${img.suggestedAlt}"`) %>
                                                                            </code>
                                                                        </div>
                                                                        
                                                                        <div class="mt-2">
                                                                            <div class="alert alert-success py-2">
                                                                                <small>
                                                                                    <strong>💡 Suggested Alt Text:</strong> "<%= img.suggestedAlt %>"<br>
                                                                                    <em>Customize this text to better describe your specific image content.</em>
                                                                                </small>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }); %>
                                                        
                                                        <div class="alert alert-warning">
                                                            <h6><i class="fas fa-lightbulb me-2"></i>Alt Text Best Practices:</h6>
                                                            <ul class="mb-0">
                                                                <li>Keep it under 125 characters</li>
                                                                <li>Describe what you see, not what you think</li>
                                                                <li>Don't start with "Image of" or "Picture of"</li>
                                                                <li>For decorative images, use empty alt: <code>alt=""</code></li>
                                                                <li>For functional images (buttons, links), describe the function</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>

                                    <!-- Schema Validation Issues -->
                                    <% if (rec.details && (rec.details.type === 'missing_schema' || rec.details.type === 'schema_errors' || rec.details.type === 'invalid_schemas' || rec.details.type === 'missing_recommended_schemas')) { %>
                                    <div class="mt-3">
                                        <% if (rec.details.type === 'missing_schema') { %>
                                        <h6>🏗️ Recommended Schema Types:</h6>
                                        <div class="accordion" id="schemaAccordion<%= index %>">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#schemaDetails<%= index %>">
                                                        <i class="fas fa-code me-2"></i>View Schema Examples
                                                    </button>
                                                </h2>
                                                <div id="schemaDetails<%= index %>" class="accordion-collapse collapse" data-bs-parent="#schemaAccordion<%= index %>">
                                                    <div class="accordion-body">
                                                        <div class="alert alert-info mb-3">
                                                            <i class="fas fa-info-circle me-2"></i>
                                                            <strong>What is Schema.org?</strong> Structured data that helps search engines understand your content and display rich snippets in search results.
                                                        </div>
                                                        
                                                        <% Object.entries(rec.details.examples).forEach(([schemaType, example]) => { %>
                                                        <div class="card mb-3">
                                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                                <span><strong><%= schemaType %> Schema</strong></span>
                                                                <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('schema<%= index %>_<%= schemaType %>')">
                                                                    <i class="fas fa-copy me-1"></i>Copy Code
                                                                </button>
                                                            </div>
                                                            <div class="card-body">
                                                                <p class="text-muted mb-2">
                                                                    <% const schemaInfo = rec.details.recommendedSchemas.find(s => s.type === schemaType) %>
                                                                    <% if (schemaInfo) { %>
                                                                        <%= schemaInfo.description %>
                                                                    <% } %>
                                                                </p>
                                                                <div class="bg-dark p-3 rounded">
                                                                    <pre id="schema<%= index %>_<%= schemaType %>" class="text-light mb-0" style="font-size: 0.9rem;"><code>&lt;script type="application/ld+json"&gt;
<%= JSON.stringify(example, null, 2) %>
&lt;/script&gt;</code></pre>
                                                                </div>
                                                                <div class="mt-2">
                                                                    <small class="text-muted">
                                                                        <strong>📍 Where to add:</strong> Place this code in the &lt;head&gt; section of your HTML document.
                                                                    </small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <% }); %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>

                                        <% if (rec.details.type === 'invalid_schemas') { %>
                                        <h6>⚠️ Schema Validation Errors:</h6>
                                        <div class="accordion" id="schemaErrorAccordion<%= index %>">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#schemaErrorDetails<%= index %>">
                                                        <i class="fas fa-tools me-2"></i>View Fixes for <%= rec.details.schemas.length %> Schema(s)
                                                    </button>
                                                </h2>
                                                <div id="schemaErrorDetails<%= index %>" class="accordion-collapse collapse" data-bs-parent="#schemaErrorAccordion<%= index %>">
                                                    <div class="accordion-body">
                                                        <% rec.details.schemas.forEach((schema, schemaIndex) => { %>
                                                        <div class="card mb-3">
                                                            <div class="card-header">
                                                                <strong><%= schema.type %> Schema Issues</strong>
                                                            </div>
                                                            <div class="card-body">
                                                                <h6>🚨 Errors Found:</h6>
                                                                <ul class="list-group list-group-flush mb-3">
                                                                    <% schema.errors.forEach(error => { %>
                                                                    <li class="list-group-item d-flex align-items-center">
                                                                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                                                        <%= error %>
                                                                    </li>
                                                                    <% }); %>
                                                                </ul>
                                                                
                                                                <% if (schema.fixes && schema.fixes.length > 0) { %>
                                                                <h6>🔧 Suggested Fixes:</h6>
                                                                <% schema.fixes.forEach(fix => { %>
                                                                <div class="alert alert-success py-2 mb-2">
                                                                    <strong><%= fix.property %>:</strong> <%= fix.suggestion %>
                                                                    <br><code><%= fix.example %></code>
                                                                </div>
                                                                <% }); %>
                                                                <% } %>
                                                            </div>
                                                        </div>
                                                        <% }); %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>
                <% } %>

                <!-- Detailed Analysis -->
                <div class="row">
                    <!-- Meta Data -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Meta Data</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <strong>Title:</strong>
                                    <p class="mb-1"><%= report.details.meta.title || 'Missing' %></p>
                                    <small class="text-muted">Length: <%= (report.details.meta.title || '').length %> characters</small>
                                </div>
                                <div class="mb-3">
                                    <strong>Description:</strong>
                                    <p class="mb-1"><%= report.details.meta.description || 'Missing' %></p>
                                    <small class="text-muted">Length: <%= (report.details.meta.description || '').length %> characters</small>
                                </div>
                                <div class="mb-3">
                                    <strong>Keywords:</strong>
                                    <p class="mb-1"><%= report.details.meta.keywords || 'None' %></p>
                                </div>
                                <div>
                                    <strong>Canonical URL:</strong>
                                    <p class="mb-1"><%= report.details.meta.canonical || 'Not set' %></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Headings -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-heading me-2"></i>Heading Structure</h6>
                            </div>
                            <div class="card-body">
                                <% ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].forEach(tag => { %>
                                    <% if (report.details.headings[tag] && report.details.headings[tag].length > 0) { %>
                                    <div class="mb-2">
                                        <strong><%= tag.toUpperCase() %>:</strong> <%= report.details.headings[tag].length %> found
                                        <% report.details.headings[tag].slice(0, 3).forEach(heading => { %>
                                        <div class="ms-3 text-muted small">
                                            <%= heading.substring(0, 80) %><%= heading.length > 80 ? '...' : '' %>
                                        </div>
                                        <% }); %>
                                    </div>
                                    <% } %>
                                <% }); %>
                            </div>
                        </div>
                    </div>

                    <!-- Images Analysis -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-images me-2"></i>Images Analysis</h6>
                            </div>
                            <div class="card-body">
                                <!-- Images Summary -->
                                <div class="row text-center mb-4">
                                    <div class="col-md-3">
                                        <div class="stat-number text-primary"><%= report.details.images.length %></div>
                                        <div class="stat-label">Total Images</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-danger">
                                            <%= report.details.images.filter(img => img.isEmpty).length %>
                                        </div>
                                        <div class="stat-label">Missing Alt Text</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-warning">
                                            <%= report.details.images.filter(img => img.altLength > 125).length %>
                                        </div>
                                        <div class="stat-label">Alt Text Too Long</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-success">
                                            <%= report.details.images.filter(img => img.hasAlt && img.altLength <= 125).length %>
                                        </div>
                                        <div class="stat-label">Properly Optimized</div>
                                    </div>
                                </div>

                                <% if (report.details.images.length > 0) { %>
                                <div class="accordion" id="imagesAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#imagesDetails">
                                                <i class="fas fa-table me-2"></i>View Detailed Images Table (<%= report.details.images.length %> images)
                                            </button>
                                        </h2>
                                        <div id="imagesDetails" class="accordion-collapse collapse" data-bs-parent="#imagesAccordion">
                                            <div class="accordion-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th width="80">Preview</th>
                                                                <th width="200">Image Source</th>
                                                                <th width="150">Alt Text</th>
                                                                <th width="100">Dimensions</th>
                                                                <th width="100">Status</th>
                                                                <th width="150">Context</th>
                                                                <th>SEO Issues</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% report.details.images.forEach((img, index) => { %>
                                                            <tr class="<%= img.isEmpty ? 'table-danger' : img.altLength > 125 ? 'table-warning' : '' %>">
                                                                <td>
                                                                    <div class="image-preview">
                                                                        <img src="<%= img.src %>" 
                                                                             alt="<%= img.alt || 'No alt text' %>"
                                                                             class="img-thumbnail"
                                                                             style="max-width: 60px; max-height: 60px; object-fit: cover;"
                                                                             loading="lazy"
                                                                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEwyNSAxNUwzNSAyNUw0MCAyMFY1SDE1VjM1SDQ1VjMwTDQwIDI1TDM1IDE1TDI1IDIwWiIgZmlsbD0iIzk5OTk5OSIvPgo8L3N2Zz4K'; this.onerror=null;">
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="text-truncate" style="max-width: 180px;" title="<%= img.src %>">
                                                                        <small class="text-muted">
                                                                            <%= img.src.length > 50 ? '...' + img.src.substring(img.src.length - 47) : img.src %>
                                                                        </small>
                                                                    </div>
                                                                    <% if (img.originalSrc !== img.src) { %>
                                                                    <div>
                                                                        <small class="text-primary">
                                                                            Original: <%= img.originalSrc %>
                                                                        </small>
                                                                    </div>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (img.alt) { %>
                                                                        <div class="text-truncate" title="<%= img.alt %>">
                                                                            <%= img.alt.length > 30 ? img.alt.substring(0, 30) + '...' : img.alt %>
                                                                        </div>
                                                                        <small class="text-muted">
                                                                            <%= img.altLength %> chars
                                                                        </small>
                                                                    <% } else { %>
                                                                        <span class="text-danger">
                                                                            <i class="fas fa-times"></i> Missing
                                                                        </span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (img.width && img.height) { %>
                                                                        <span class="badge bg-info">
                                                                            <%= img.width %>×<%= img.height %>
                                                                        </span>
                                                                    <% } else { %>
                                                                        <span class="text-muted">Unknown</span>
                                                                    <% } %>
                                                                    <% if (img.loading) { %>
                                                                    <br><small class="text-success">
                                                                        <i class="fas fa-rocket"></i> <%= img.loading %>
                                                                    </small>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (img.isEmpty) { %>
                                                                        <span class="badge bg-danger">
                                                                            <i class="fas fa-exclamation-triangle"></i> No Alt
                                                                        </span>
                                                                    <% } else if (img.altLength > 125) { %>
                                                                        <span class="badge bg-warning">
                                                                            <i class="fas fa-exclamation-circle"></i> Too Long
                                                                        </span>
                                                                    <% } else { %>
                                                                        <span class="badge bg-success">
                                                                            <i class="fas fa-check"></i> Good
                                                                        </span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (img.context && img.context.parentTag) { %>
                                                                        <small class="text-muted">
                                                                            &lt;<%= img.context.parentTag %>&gt;
                                                                        </small>
                                                                    <% } %>
                                                                    <% if (img.context && img.context.nearbyText) { %>
                                                                        <div class="text-truncate" style="max-width: 130px;" title="<%= img.context.nearbyText %>">
                                                                            <small>
                                                                                <%= img.context.nearbyText.length > 30 ? img.context.nearbyText.substring(0, 30) + '...' : img.context.nearbyText %>
                                                                            </small>
                                                                        </div>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex flex-column gap-1">
                                                                        <% if (img.isEmpty) { %>
                                                                            <span class="badge bg-danger text-wrap">Missing alt attribute for accessibility</span>
                                                                        <% } %>
                                                                        <% if (img.altLength > 125) { %>
                                                                            <span class="badge bg-warning text-wrap">Alt text too long (125+ chars)</span>
                                                                        <% } %>
                                                                        <% if (!img.loading && img.width && parseInt(img.width) > 800) { %>
                                                                            <span class="badge bg-info text-wrap">Consider lazy loading</span>
                                                                        <% } %>
                                                                        <% if (!img.width || !img.height) { %>
                                                                            <span class="badge bg-secondary text-wrap">Missing dimensions</span>
                                                                        <% } %>
                                                                        <% if (img.isEmpty && img.altLength === 0 && !img.isDecorative) { %>
                                                                            <span class="badge bg-primary text-wrap">Add descriptive alt text</span>
                                                                        <% } %>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <div class="alert alert-info">
                                                        <h6><i class="fas fa-lightbulb me-2"></i>Image SEO Best Practices:</h6>
                                                        <ul class="mb-0">
                                                            <li><strong>Alt Text:</strong> Keep under 125 characters, describe what you see</li>
                                                            <li><strong>Dimensions:</strong> Specify width and height to prevent layout shift</li>
                                                            <li><strong>Lazy Loading:</strong> Use loading="lazy" for images below the fold</li>
                                                            <li><strong>File Format:</strong> Use WebP or AVIF for better compression</li>
                                                            <li><strong>File Size:</strong> Optimize images to reduce page load time</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } else { %>
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-image fa-3x mb-3"></i>
                                    <p>No images found on this page</p>
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Links Analysis -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-link me-2"></i>Links Analysis</h6>
                            </div>
                            <div class="card-body">
                                <!-- Links Summary -->
                                <div class="row text-center mb-4">
                                    <div class="col-md-3">
                                        <div class="stat-number text-primary">
                                            <%= report.details.links.internal.length + report.details.links.external.length %>
                                        </div>
                                        <div class="stat-label">Total Links</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-success"><%= report.details.links.internal.length %></div>
                                        <div class="stat-label">Internal Links</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-info"><%= report.details.links.external.length %></div>
                                        <div class="stat-label">External Links</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="stat-number text-warning">
                                            <%= report.details.links.external.filter(link => !link.rel || !link.rel.includes('nofollow')).length %>
                                        </div>
                                        <div class="stat-label">Follow Links</div>
                                    </div>
                                </div>

                                <!-- Internal Links Table -->
                                <% if (report.details.links.internal.length > 0) { %>
                                <div class="accordion mb-3" id="internalLinksAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#internalLinksDetails">
                                                <i class="fas fa-home me-2"></i>Internal Links (<%= report.details.links.internal.length %> links)
                                            </button>
                                        </h2>
                                        <div id="internalLinksDetails" class="accordion-collapse collapse" data-bs-parent="#internalLinksAccordion">
                                            <div class="accordion-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-sm">
                                                        <thead class="table-success">
                                                            <tr>
                                                                <th width="40%">Link URL</th>
                                                                <th width="30%">Anchor Text</th>
                                                                <th width="15%">Title</th>
                                                                <th width="15%">Attributes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% report.details.links.internal.slice(0, 50).forEach((link, index) => { %>
                                                            <tr>
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-home text-success me-2"></i>
                                                                        <div>
                                                                            <div class="text-truncate" style="max-width: 300px;" title="<%= link.href %>">
                                                                                <a href="<%= link.href %>" target="_blank" class="text-decoration-none">
                                                                                    <%= link.href.length > 60 ? link.href.substring(0, 60) + '...' : link.href %>
                                                                                </a>
                                                                            </div>
                                                                            <% if (link.href.includes('#')) { %>
                                                                            <small class="text-info">
                                                                                <i class="fas fa-anchor"></i> Anchor link
                                                                            </small>
                                                                            <% } %>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <% if (link.text && link.text.trim()) { %>
                                                                        <div class="text-truncate" title="<%= link.text %>">
                                                                            <%= link.text.length > 40 ? link.text.substring(0, 40) + '...' : link.text %>
                                                                        </div>
                                                                        <small class="text-muted">
                                                                            <%= link.text.length %> chars
                                                                        </small>
                                                                    <% } else { %>
                                                                        <span class="text-warning">
                                                                            <i class="fas fa-exclamation-triangle"></i> Empty anchor text
                                                                        </span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (link.title) { %>
                                                                        <div class="text-truncate" title="<%= link.title %>">
                                                                            <small><%= link.title.length > 30 ? link.title.substring(0, 30) + '...' : link.title %></small>
                                                                        </div>
                                                                    <% } else { %>
                                                                        <span class="text-muted">-</span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% if (link.rel) { %>
                                                                        <% link.rel.split(' ').forEach(relValue => { %>
                                                                        <span class="badge bg-secondary me-1"><%= relValue %></span>
                                                                        <% }); %>
                                                                    <% } else { %>
                                                                        <span class="text-muted">None</span>
                                                                    <% } %>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                            <% if (report.details.links.internal.length > 50) { %>
                                                            <tr>
                                                                <td colspan="4" class="text-center text-muted">
                                                                    <i class="fas fa-ellipsis-h"></i> Showing first 50 of <%= report.details.links.internal.length %> internal links
                                                                </td>
                                                            </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } %>

                                <!-- External Links Table -->
                                <% if (report.details.links.external.length > 0) { %>
                                <div class="accordion" id="externalLinksAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#externalLinksDetails">
                                                <i class="fas fa-external-link-alt me-2"></i>External Links (<%= report.details.links.external.length %> links)
                                            </button>
                                        </h2>
                                        <div id="externalLinksDetails" class="accordion-collapse collapse" data-bs-parent="#externalLinksAccordion">
                                            <div class="accordion-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-sm">
                                                        <thead class="table-info">
                                                            <tr>
                                                                <th width="40%">External URL</th>
                                                                <th width="25%">Anchor Text</th>
                                                                <th width="15%">Domain</th>
                                                                <th width="20%">SEO Attributes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% report.details.links.external.slice(0, 50).forEach((link, index) => { %>
                                                            <tr class="<%= !link.rel || !link.rel.includes('nofollow') ? 'table-warning' : '' %>">
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-external-link-alt text-info me-2"></i>
                                                                        <div>
                                                                            <div class="text-truncate" style="max-width: 300px;" title="<%= link.href %>">
                                                                                <a href="<%= link.href %>" target="_blank" class="text-decoration-none">
                                                                                    <%= link.href.length > 60 ? link.href.substring(0, 60) + '...' : link.href %>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <% if (link.text && link.text.trim()) { %>
                                                                        <div class="text-truncate" title="<%= link.text %>">
                                                                            <%= link.text.length > 35 ? link.text.substring(0, 35) + '...' : link.text %>
                                                                        </div>
                                                                    <% } else { %>
                                                                        <span class="text-warning">
                                                                            <i class="fas fa-exclamation-triangle"></i> Empty
                                                                        </span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <% 
                                                                    try {
                                                                        const domain = new URL(link.href).hostname;
                                                                    %>
                                                                        <span class="badge bg-light text-dark">
                                                                            <%= domain.replace('www.', '') %>
                                                                        </span>
                                                                    <% } catch(e) { %>
                                                                        <span class="text-muted">Invalid URL</span>
                                                                    <% } %>
                                                                </td>
                                                                <td>
                                                                    <div class="d-flex flex-wrap gap-1">
                                                                        <% if (link.rel) { %>
                                                                            <% if (link.rel.includes('nofollow')) { %>
                                                                                <span class="badge bg-success">nofollow</span>
                                                                            <% } else { %>
                                                                                <span class="badge bg-warning">follow</span>
                                                                            <% } %>
                                                                            <% if (link.rel.includes('noopener')) { %>
                                                                                <span class="badge bg-info">noopener</span>
                                                                            <% } %>
                                                                            <% if (link.rel.includes('noreferrer')) { %>
                                                                                <span class="badge bg-info">noreferrer</span>
                                                                            <% } %>
                                                                            <% if (link.rel.includes('sponsored')) { %>
                                                                                <span class="badge bg-secondary">sponsored</span>
                                                                            <% } %>
                                                                        <% } else { %>
                                                                            <span class="badge bg-warning">follow</span>
                                                                        <% } %>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                            <% if (report.details.links.external.length > 50) { %>
                                                            <tr>
                                                                <td colspan="4" class="text-center text-muted">
                                                                    <i class="fas fa-ellipsis-h"></i> Showing first 50 of <%= report.details.links.external.length %> external links
                                                                </td>
                                                            </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <div class="alert alert-warning">
                                                        <h6><i class="fas fa-lightbulb me-2"></i>External Link SEO Best Practices:</h6>
                                                        <ul class="mb-0">
                                                            <li><strong>rel="nofollow":</strong> Use for untrusted or paid links to prevent passing PageRank</li>
                                                            <li><strong>rel="noopener":</strong> Security measure for target="_blank" links</li>
                                                            <li><strong>rel="sponsored":</strong> Mark paid or sponsored content links</li>
                                                            <li><strong>Descriptive anchor text:</strong> Use meaningful text that describes the destination</li>
                                                            <li><strong>Link relevance:</strong> Ensure external links are relevant to your content</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } %>

                                <% if (report.details.links.internal.length === 0 && report.details.links.external.length === 0) { %>
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-link fa-3x mb-3"></i>
                                    <p>No links found on this page</p>
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Schema Analysis -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-sitemap me-2"></i>Structured Data</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center mb-3">
                                    <div class="col-6">
                                        <div class="stat-number text-primary"><%= report.details.schema.summary.totalSchemas %></div>
                                        <div class="stat-label">Total Schemas</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="stat-number text-danger"><%= report.details.schema.errors.length %></div>
                                        <div class="stat-label">Errors</div>
                                    </div>
                                </div>
                                <div class="schema-types">
                                    <% if (report.details.schema.summary.hasOrganization) { %>
                                    <span class="badge bg-success me-1 mb-1">Organization</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.hasWebsite) { %>
                                    <span class="badge bg-success me-1 mb-1">WebSite</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.hasProduct) { %>
                                    <span class="badge bg-success me-1 mb-1">Product</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.hasArticle) { %>
                                    <span class="badge bg-success me-1 mb-1">Article</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.hasBreadcrumb) { %>
                                    <span class="badge bg-success me-1 mb-1">Breadcrumb</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.hasLocalBusiness) { %>
                                    <span class="badge bg-success me-1 mb-1">LocalBusiness</span>
                                    <% } %>
                                    <% if (report.details.schema.summary.totalSchemas === 0) { %>
                                    <span class="text-muted">No structured data found</span>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Analysis -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Content Analysis</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-number text-primary"><%= report.details.content.wordCount %></div>
                                        <div class="stat-label">Word Count</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-number text-success"><%= report.details.content.characterCount %></div>
                                        <div class="stat-label">Characters</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-number text-info"><%= report.details.content.readabilityScore %></div>
                                        <div class="stat-label">Readability</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schema Markup Checker & Validator -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-clipboard-check me-2"></i>Schema Markup Checker & Validator
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Schema.org Structured Data Status:</strong> This checklist shows which schema types are implemented on your website and which are missing. Structured data helps search engines understand your content and display rich snippets.
                        </div>
                        
                        <div class="row">
                            <!-- Core Schema Elements -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-danger">
                                    <div class="card-header bg-danger text-white">
                                        <h6 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Core Schema Elements</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="schema-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasAuthor ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Author</strong>
                                                    <br><small class="text-muted">Content author information (meta tag or schema)</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasAuthor) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasPublisher ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Publisher</strong>
                                                    <br><small class="text-muted">Content publisher organization information</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasPublisher) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasFocusKeyword ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Focus Keyword</strong>
                                                    <br><small class="text-muted">Keywords meta tag or schema keywords property</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasFocusKeyword) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Recommended</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.schema.summary.hasSection ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Section</strong>
                                                    <br><small class="text-muted">HTML5 section tags or articleSection property</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasSection) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Recommended</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Essential Business Schema -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0"><i class="fas fa-building me-2"></i>Essential Business Schema</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="schema-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasOrganization ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Organization</strong>
                                                    <br><small class="text-muted">Business identity and contact information</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasOrganization) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasWebsite ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>WebSite</strong>
                                                    <br><small class="text-muted">Website information and search functionality</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasWebsite) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasWebApplication ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>WebApplication</strong>
                                                    <br><small class="text-muted">Web application schema for software applications</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasWebApplication) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasLocalBusiness ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>LocalBusiness</strong>
                                                    <br><small class="text-muted">Physical location and business hours</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasLocalBusiness) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Recommended</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.schema.summary.hasBreadcrumb ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>BreadcrumbList</strong>
                                                    <br><small class="text-muted">Navigation breadcrumbs for site structure</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasBreadcrumb) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Recommended</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Content Schema -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Content Schema</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="schema-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasArticle ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Article</strong>
                                                    <br><small class="text-muted">Blog posts, news articles, and content pages</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasArticle) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasFAQ ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>FAQPage</strong>
                                                    <br><small class="text-muted">Frequently asked questions and answers</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasFAQ) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasVideoObject ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>VideoObject</strong>
                                                    <br><small class="text-muted">Video content and media</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasVideoObject) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.schema.summary.hasImageObject ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>ImageObject</strong>
                                                    <br><small class="text-muted">Image content and galleries</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasImageObject) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- E-commerce & Services Schema -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>E-commerce & Services</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="schema-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasProduct ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Product</strong>
                                                    <br><small class="text-muted">Product listings and e-commerce items</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasProduct) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasService ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Service</strong>
                                                    <br><small class="text-muted">Service offerings and descriptions</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasService) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasReview ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Review</strong>
                                                    <br><small class="text-muted">Customer reviews and ratings</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasReview) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.schema.summary.hasRestaurant ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Restaurant</strong>
                                                    <br><small class="text-muted">Restaurant information and menus</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasRestaurant) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Specialized Schema -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h6 class="mb-0"><i class="fas fa-star me-2"></i>Specialized Schema</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="schema-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasPerson ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Person</strong>
                                                    <br><small class="text-muted">Author profiles and personal information</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasPerson) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasEvent ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Event</strong>
                                                    <br><small class="text-muted">Events, conferences, and meetings</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasEvent) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.schema.summary.hasJobPosting ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>JobPosting</strong>
                                                    <br><small class="text-muted">Job listings and career opportunities</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasJobPosting) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.schema.summary.hasRecipe ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Recipe</strong>
                                                    <br><small class="text-muted">Cooking recipes and instructions</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.schema.summary.hasRecipe) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Optional</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Summary Stats -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert <%= report.details.schema.summary.totalSchemas === 0 ? 'alert-danger' : report.details.schema.summary.totalSchemas >= 3 ? 'alert-success' : 'alert-warning' %>">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h6 class="mb-1">
                                                <i class="fas fa-chart-pie me-2"></i>Schema Implementation Summary
                                            </h6>
                                            <% if (report.details.schema.summary.totalSchemas === 0) { %>
                                                <span>No structured data found on this page. Consider implementing basic schema types like Organization and WebSite.</span>
                                            <% } else { %>
                                                <span>Found <%= report.details.schema.summary.totalSchemas %> schema type(s) implemented. 
                                                <% if (report.details.schema.summary.totalSchemas >= 3) { %>
                                                    Great job! Your site has good structured data coverage.
                                                <% } else { %>
                                                    Consider adding more schema types to improve search visibility.
                                                <% } %>
                                                </span>
                                            <% } %>
                                        </div>
                                        <div class="col-md-4 text-center">
                                            <div class="schema-score-circle">
                                                <div class="score-number <%= report.details.schema.summary.totalSchemas >= 3 ? 'text-success' : report.details.schema.summary.totalSchemas >= 1 ? 'text-warning' : 'text-danger' %>">
                                                    <%= report.details.schema.summary.totalSchemas %>
                                                </div>
                                                <div class="score-label">Schema Types</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Schema Analysis -->
                <% if (report.details.schema && report.details.schema.jsonLd && report.details.schema.jsonLd.length > 0) { %>
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-code me-2"></i>Detailed Schema Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Property-by-Property Analysis:</strong> Each schema type below shows detailed validation with specific recommendations to improve your structured data for better search engine visibility.
                        </div>
                        
                        <% report.details.schema.jsonLd.forEach((schema, schemaIndex) => { %>
                            <% if (schema.detailedValidation) { %>
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-0"><%= schema.type %> Schema Analysis</h6>
                                        <small class="text-muted">Completeness: <%= schema.detailedValidation.completeness %>% | Grade: <span class="badge bg-<%= schema.detailedValidation.grade === 'A' ? 'success' : schema.detailedValidation.grade === 'B' ? 'primary' : schema.detailedValidation.grade === 'C' ? 'warning' : 'danger' %>"><%= schema.detailedValidation.grade %></span></small>
                                    </div>
                                    <div class="progress" style="width: 100px; height: 8px;">
                                        <div class="progress-bar bg-<%= schema.detailedValidation.completeness >= 80 ? 'success' : schema.detailedValidation.completeness >= 60 ? 'warning' : 'danger' %>" 
                                             role="progressbar" 
                                             style="width: <%= schema.detailedValidation.completeness %>%">
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="accordion" id="schemaValidationAccordion<%= schemaIndex %>">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#schemaValidationDetails<%= schemaIndex %>">
                                                    <i class="fas fa-list-check me-2"></i>Property Checklist (<%= schema.detailedValidation.checklist.length %> properties)
                                                </button>
                                            </h2>
                                            <div id="schemaValidationDetails<%= schemaIndex %>" class="accordion-collapse collapse" data-bs-parent="#schemaValidationAccordion<%= schemaIndex %>">
                                                <div class="accordion-body">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <h6 class="text-success mb-3">
                                                                <i class="fas fa-check-circle me-2"></i>Property Status Overview
                                                            </h6>
                                                            <div class="table-responsive">
                                                                <table class="table table-sm">
                                                                    <thead>
                                                                        <tr>
                                                                            <th width="25%">Property</th>
                                                                            <th width="15%">Status</th>
                                                                            <th width="15%">Required</th>
                                                                            <th width="45%">SEO Impact & Recommendation</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <% schema.detailedValidation.checklist.forEach(item => { %>
                                                                        <tr class="<%= item.present ? '' : (item.required ? 'table-danger' : 'table-warning') %>">
                                                                            <td>
                                                                                <code><%= item.property %></code>
                                                                            </td>
                                                                            <td>
                                                                                <% if (item.present) { %>
                                                                                    <span class="badge bg-success">
                                                                                        <i class="fas fa-check me-1"></i>Present
                                                                                    </span>
                                                                                <% } else { %>
                                                                                    <span class="badge bg-<%= item.required ? 'danger' : 'warning' %>">
                                                                                        <i class="fas fa-times me-1"></i>Missing
                                                                                    </span>
                                                                                <% } %>
                                                                            </td>
                                                                            <td>
                                                                                <span class="badge bg-<%= item.required ? 'danger' : 'secondary' %>">
                                                                                    <%= item.required ? 'Required' : 'Optional' %>
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                <small>
                                                                                    <strong>Impact:</strong> <%= item.impact %><br>
                                                                                    <% if (!item.present) { %>
                                                                                    <strong>Example:</strong> <code style="font-size: 0.8rem;"><%= item.example %></code>
                                                                                    <% } %>
                                                                                </small>
                                                                            </td>
                                                                        </tr>
                                                                        <% }); %>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <% if (schema.detailedValidation.recommendations && (schema.detailedValidation.recommendations.critical.length > 0 || schema.detailedValidation.recommendations.recommended.length > 0)) { %>
                                                    <hr>
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <h6 class="text-warning mb-3">
                                                                <i class="fas fa-exclamation-triangle me-2"></i>Improvement Recommendations
                                                            </h6>
                                                            
                                                            <% if (schema.detailedValidation.recommendations.critical.length > 0) { %>
                                                            <div class="alert alert-danger">
                                                                <h6><i class="fas fa-exclamation-circle me-2"></i>Critical Missing Properties (<%= schema.detailedValidation.recommendations.critical.length %>)</h6>
                                                                <ul class="mb-0">
                                                                    <% schema.detailedValidation.recommendations.critical.forEach(item => { %>
                                                                    <li>
                                                                        <strong><%= item.property %>:</strong> <%= item.impact %>
                                                                        <br><small class="text-muted">Add: <code><%= item.example %></code></small>
                                                                    </li>
                                                                    <% }); %>
                                                                </ul>
                                                            </div>
                                                            <% } %>
                                                            
                                                            <% if (schema.detailedValidation.recommendations.recommended.length > 0) { %>
                                                            <div class="alert alert-warning">
                                                                <h6><i class="fas fa-info-circle me-2"></i>Recommended Properties (<%= schema.detailedValidation.recommendations.recommended.length %>)</h6>
                                                                <ul class="mb-0">
                                                                    <% schema.detailedValidation.recommendations.recommended.forEach(item => { %>
                                                                    <li>
                                                                        <strong><%= item.property %>:</strong> <%= item.impact %>
                                                                        <br><small class="text-muted">Add: <code><%= item.example %></code></small>
                                                                    </li>
                                                                    <% }); %>
                                                                </ul>
                                                            </div>
                                                            <% } %>
                                                        </div>
                                                    </div>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                        <% }); %>
                    </div>
                </div>
                <% } %>

                <!-- PWA Analysis -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-mobile-alt me-2"></i>Progressive Web App (PWA) Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>PWA Compliance Check:</strong> Progressive Web Apps provide app-like experiences on the web with offline functionality, installability, and enhanced mobile features.
                        </div>
                        
                        <!-- PWA Status Summary -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <h6 class="mb-3">
                                    <i class="fas fa-mobile-alt me-2"></i>PWA Status Overview
                                </h6>
                                <div class="alert <%= report.details.pwa.hasManifest ? 'alert-success' : 'alert-warning' %> mb-2">
                                    <% if (report.details.pwa.hasManifest) { %>
                                        <i class="fas fa-check-circle me-2"></i>
                                        <strong>PWA Detected:</strong> This website has PWA capabilities with a Web App Manifest present.
                                    <% } else { %>
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>No PWA:</strong> This website does not have PWA capabilities - no Web App Manifest found.
                                    <% } %>
                                </div>
                                <small class="text-muted">
                                    <% if (report.details.pwa.hasManifest) { %>
                                        Your site can be installed as an app and provides enhanced mobile experience.
                                    <% } else { %>
                                        Consider implementing a Web App Manifest to enable PWA features and improve mobile engagement.
                                    <% } %>
                                </small>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="pwa-status-indicator">
                                    <div class="status-badge <%= report.details.pwa.hasManifest ? 'bg-success' : 'bg-secondary' %> text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                                        <% if (report.details.pwa.hasManifest) { %>
                                            <i class="fas fa-mobile-alt fa-2x"></i>
                                        <% } else { %>
                                            <i class="fas fa-times fa-2x"></i>
                                        <% } %>
                                    </div>
                                    <div class="mt-2 fw-bold">
                                        <%= report.details.pwa.hasManifest ? 'Has PWA' : 'No PWA' %>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- Core PWA Requirements -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0"><i class="fas fa-cogs me-2"></i>Core PWA Requirements</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="pwa-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.hasManifest ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Web App Manifest</strong>
                                                    <br><small class="text-muted">manifest.json file for app metadata</small>
                                                    <% if (report.details.pwa.manifestUrl) { %>
                                                    <br><small class="text-primary">Found: <%= report.details.pwa.manifestUrl %></small>
                                                    <% } %>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.hasManifest) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.hasServiceWorker ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Service Worker</strong>
                                                    <br><small class="text-muted">JavaScript worker for offline functionality</small>
                                                    <% if (report.details.pwa.serviceWorkerUrls.length > 0) { %>
                                                    <br><small class="text-primary">Found: <%= report.details.pwa.serviceWorkerUrls.join(', ') %></small>
                                                    <% } %>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.hasServiceWorker) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.capabilities.isInstallable ? 'bg-success bg-opacity-10' : 'bg-danger bg-opacity-10' %>">
                                                <div>
                                                    <strong>Installable</strong>
                                                    <br><small class="text-muted">Can be installed as an app</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.capabilities.isInstallable) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Yes</span>
                                                    <% } else { %>
                                                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>No</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.pwa.capabilities.hasOfflineCapability ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Offline Capability</strong>
                                                    <br><small class="text-muted">Works without internet connection</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.capabilities.hasOfflineCapability) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Available</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Limited</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PWA Meta Tags -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0"><i class="fas fa-tags me-2"></i>PWA Meta Tags</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="pwa-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.metaTags.themeColor ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Theme Color</strong>
                                                    <br><small class="text-muted">Browser theme color customization</small>
                                                    <% if (report.details.pwa.metaTags.themeColor) { %>
                                                    <br><small class="text-primary">Color: <%= report.details.pwa.metaTags.themeColor %></small>
                                                    <% } %>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.metaTags.themeColor) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Set</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.metaTags.appleWebAppCapable ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Apple Web App</strong>
                                                    <br><small class="text-muted">iOS full-screen web app mode</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.metaTags.appleWebAppCapable) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Enabled</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Disabled</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.metaTags.appleTouchIcons.length > 0 ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Apple Touch Icons</strong>
                                                    <br><small class="text-muted">iOS home screen icons</small>
                                                    <% if (report.details.pwa.metaTags.appleTouchIcons.length > 0) { %>
                                                    <br><small class="text-primary"><%= report.details.pwa.metaTags.appleTouchIcons.length %> icon(s) found</small>
                                                    <% } %>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.metaTags.appleTouchIcons.length > 0) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Present</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.pwa.metaTags.appleWebAppTitle ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Apple App Title</strong>
                                                    <br><small class="text-muted">iOS app name when installed</small>
                                                    <% if (report.details.pwa.metaTags.appleWebAppTitle) { %>
                                                    <br><small class="text-primary">Title: <%= report.details.pwa.metaTags.appleWebAppTitle %></small>
                                                    <% } %>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.metaTags.appleWebAppTitle) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Set</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Missing</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PWA Features -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0"><i class="fas fa-rocket me-2"></i>PWA Features</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="pwa-checklist">
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.features.pushNotifications ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Push Notifications</strong>
                                                    <br><small class="text-muted">Browser notifications support</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.features.pushNotifications) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Supported</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Not Detected</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.features.backgroundSync ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Background Sync</strong>
                                                    <br><small class="text-muted">Sync data when connection restored</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.features.backgroundSync) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Available</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Not Detected</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 rounded <%= report.details.pwa.features.geolocation ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Geolocation</strong>
                                                    <br><small class="text-muted">Location-based services</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.features.geolocation) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Used</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Not Used</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center p-2 rounded <%= report.details.pwa.features.webShare ? 'bg-success bg-opacity-10' : 'bg-warning bg-opacity-10' %>">
                                                <div>
                                                    <strong>Web Share API</strong>
                                                    <br><small class="text-muted">Native sharing functionality</small>
                                                </div>
                                                <div>
                                                    <% if (report.details.pwa.features.webShare) { %>
                                                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Implemented</span>
                                                    <% } else { %>
                                                        <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Not Implemented</span>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Manifest Details -->
                            <div class="col-lg-6 mb-4">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h6 class="mb-0"><i class="fas fa-file-code me-2"></i>Manifest Details</h6>
                                    </div>
                                    <div class="card-body">
                                        <% if (report.details.pwa.hasManifest && report.details.pwa.manifestData) { %>
                                        <div class="manifest-details">
                                            <% const manifest = report.details.pwa.manifestData %>
                                            <div class="mb-2">
                                                <strong>App Name:</strong> 
                                                <span class="text-muted"><%= manifest.name || manifest.short_name || 'Not specified' %></span>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Short Name:</strong> 
                                                <span class="text-muted"><%= manifest.short_name || 'Not specified' %></span>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Start URL:</strong> 
                                                <span class="text-muted"><%= manifest.start_url || 'Not specified' %></span>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Display Mode:</strong> 
                                                <span class="text-muted"><%= manifest.display || 'Not specified' %></span>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Theme Color:</strong> 
                                                <span class="text-muted"><%= manifest.theme_color || 'Not specified' %></span>
                                            </div>
                                            <div class="mb-2">
                                                <strong>Background Color:</strong> 
                                                <span class="text-muted"><%= manifest.background_color || 'Not specified' %></span>
                                            </div>
                                            <% if (report.details.pwa.icons && report.details.pwa.icons.length > 0) { %>
                                            <div class="mb-2">
                                                <strong>Icons:</strong> 
                                                <span class="text-muted"><%= report.details.pwa.icons.length %> icon(s)</span>
                                                <br>
                                                <% report.details.pwa.icons.slice(0, 3).forEach(icon => { %>
                                                <small class="text-primary d-block">• <%= icon.sizes %> - <%= icon.type || 'image' %></small>
                                                <% }); %>
                                            </div>
                                            <% } %>
                                        </div>
                                        <% } else { %>
                                        <div class="text-center text-muted">
                                            <i class="fas fa-file-times fa-2x mb-2"></i>
                                            <p>No manifest file detected</p>
                                            <small>Add a manifest.json file to enable PWA installation</small>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PWA Recommendations -->
                        <% if (report.details.pwa.recommendations && report.details.pwa.recommendations.length > 0) { %>
                        <div class="mt-4">
                            <h6 class="mb-3">
                                <i class="fas fa-lightbulb me-2"></i>PWA Improvement Recommendations
                            </h6>
                            <div class="accordion" id="pwaRecommendationsAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pwaRecommendations">
                                            <i class="fas fa-tools me-2"></i>View <%= report.details.pwa.recommendations.length %> Recommendation(s)
                                        </button>
                                    </h2>
                                    <div id="pwaRecommendations" class="accordion-collapse collapse" data-bs-parent="#pwaRecommendationsAccordion">
                                        <div class="accordion-body">
                                            <% report.details.pwa.recommendations.forEach((rec, index) => { %>
                                            <div class="alert <%= rec.priority === 'high' ? 'alert-danger' : rec.priority === 'medium' ? 'alert-warning' : 'alert-info' %> mb-3">
                                                <div class="d-flex">
                                                    <div class="me-3">
                                                        <% if (rec.priority === 'high') { %>
                                                            <i class="fas fa-exclamation-circle"></i>
                                                        <% } else if (rec.priority === 'medium') { %>
                                                            <i class="fas fa-exclamation-triangle"></i>
                                                        <% } else { %>
                                                            <i class="fas fa-info-circle"></i>
                                                        <% } %>
                                                    </div>
                                                    <div class="flex-grow-1">
                                                        <strong><%= rec.issue %></strong>
                                                        <p class="mb-2"><%= rec.description %></p>
                                                        <% if (rec.example) { %>
                                                        <small class="text-muted">
                                                            <strong>Example:</strong> <code><%= rec.example %></code>
                                                        </small>
                                                        <% } %>
                                                        <% if (rec.details) { %>
                                                        <div class="mt-2">
                                                            <small class="text-muted">
                                                                <% rec.details.forEach(detail => { %>
                                                                <div>• <%= detail %></div>
                                                                <% }); %>
                                                            </small>
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }); %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2024 SEO Crawler. Built for analyzing website SEO performance.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize tooltips
        document.addEventListener('DOMContentLoaded', function() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                // Show success feedback
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                }, 2000);
            }).catch(function() {
                alert('Failed to copy to clipboard. Please select and copy the text manually.');
            });
        }
        
        // Add retry button functionality
        document.addEventListener('DOMContentLoaded', function() {
            const retryBtn = document.querySelector('.retry-url-btn');
            if (retryBtn) {
                retryBtn.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    const jobId = this.getAttribute('data-job-id');
                    
                    // Disable button and show loading state
                    this.disabled = true;
                    const originalHtml = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Analyzing...';
                    
                    // Make the request to re-analyze the URL
                    fetch('/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'same-origin',
                        body: JSON.stringify({
                            url: url,
                            retry: true,
                            previousJobId: jobId
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            if (response.status === 302 || response.status === 401) {
                                throw new Error('Session expired. Please refresh the page and try again.');
                            }
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success && data.batchId) {
                            // Redirect to the batch page to track progress
                            window.location.href = `/batch/${data.batchId}`;
                        } else {
                            throw new Error(data.error || data.message || 'Failed to start analysis');
                        }
                    })
                    .catch(error => {
                        // Show error and re-enable button
                        console.error('Retry analysis error:', error);
                        alert('Error: ' + error.message);
                        this.disabled = false;
                        this.innerHTML = originalHtml;
                    });
                });
            }
        });
    </script>
    <script src="/js/app.js"></script>
</body>
</html>